{"ast":null,"code":"var _jsxFileName = \"/Users/vu/Documents/Work/Repositories/co2/src/App.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport * as d3 from 'd3';\nconst constants = {\n  linear: [306.06644452, 0.00430901514],\n  quadratic: [314.574751, 0.00210065413, 0.0000000973625567],\n  cosine: [314.569048, 0.00210632696, 0.0000000970576557, 2.86111474, -0.554076698]\n},\n      styles = {\n  background: '#FFFFFF',\n  invertedBackground: '#060608',\n  dark: '#121214',\n  invertedDark: '#FFFFFF',\n  normal: '#444455',\n  light: '#888899',\n  line: '#E8E8E9',\n  theme: '#4ba824'\n},\n      vizs = {\n  lineChart: [{\n    state: 'initial',\n    des: 'The data looks like this.'\n  }, {\n    state: 'linear',\n    des: 'There is a clear and consistent upward trend through the years.'\n  }, {\n    state: 'quadratic',\n    des: 'But a quadratic trend line would be a better fit.'\n  }, {\n    state: 'cosine',\n    des: 'The levels also have a seasonal component. This could be modeled by adding a cosine term to the function.'\n  }]\n};\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      originalData: [],\n      lineChartCreated: false\n    };\n    this.createLineChart = this.createLineChart.bind(this);\n  }\n\n  createLineChart(data) {\n    let margin = {\n      top: 20,\n      right: 60,\n      bottom: 40,\n      left: 0\n    },\n        width = window.innerWidth - 440,\n        height = window.innerHeight - 200,\n        innerWidth = width - margin.left - margin.right,\n        innerHeight = height - margin.top - margin.bottom,\n        svg = d3.select('#line-chart').append('svg').attr('width', width).attr('height', height).attr('class', 'viz'),\n        x = d3.scaleTime().domain(d3.extent(data, (d, i) => {\n      return d.date;\n    })).range([0, innerWidth]).nice(),\n        y = d3.scaleLinear().domain(d3.extent(data, (d, i) => {\n      return d.level;\n    })).range([innerHeight, 0]).nice(),\n        totalLength = null; // Grid lines\n\n    svg.append('g').attr('class', 'y grid').attr('transform', 'translate(' + margin.left + ', ' + height + ')').call(d3.axisBottom(x).ticks(5).tickSize(-height).tickFormat(''));\n    d3.selectAll('.y.grid>.tick').each(function (d, i) {\n      d3.select(this).attr(\"stroke-dasharray\", height + \" \" + height).attr(\"stroke-dashoffset\", height).transition().duration(800).ease(d3.easeCubicOut).attr('stroke-dashoffset', function () {\n        if (i % 2 === 0) {\n          return 0;\n        } else {\n          return 2 * height;\n        }\n      });\n    });\n    svg.append('g').attr('class', 'x grid').attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')').call(d3.axisLeft(y).ticks(5).tickSize(-width).tickFormat(''));\n    d3.selectAll('.x.grid>.tick').each(function (d, i) {\n      d3.select(this).attr(\"stroke-dasharray\", width + \" \" + width).attr(\"stroke-dashoffset\", width).transition().duration(800).ease(d3.easeCubicOut).attr('stroke-dashoffset', function () {\n        if (i % 2 === 0) {\n          return 0;\n        } else {\n          return 2 * width;\n        }\n      });\n    }); // Axes\n\n    svg.append('g').attr('class', 'x axis').attr('transform', 'translate(' + margin.left + ', ' + (innerHeight + margin.top) + ')').style(\"opacity\", 0).transition().duration(800).ease(d3.easeQuad).style('opacity', 1).call(d3.axisBottom(x).ticks(5).tickSize(0).tickPadding(24));\n    svg.append('g').attr('class', 'y axis').attr('transform', 'translate(' + (innerWidth + margin.left) + ', ' + margin.top + ')').style(\"opacity\", 0).transition().duration(800).ease(d3.easeQuad).style('opacity', 1).call(d3.axisRight(y).ticks(5).tickSize(0).tickPadding(32));\n    svg.append('line').attr('class', 'bottom-axis').attr(\"x1\", 0).attr(\"y1\", height - margin.bottom).attr(\"x2\", width).attr(\"y2\", height - margin.bottom).style(\"opacity\", 0).transition().duration(800).ease(d3.easeQuadOut).style('opacity', 1);\n\n    let updateLineChart = function (newState) {\n      let regLineLength = null,\n          minDate = d3.min(data, function (d) {\n        return d.date;\n      }),\n          xDays = data.map(d => Math.ceil((d.date.getTime() - minDate.getTime()) / (1000 * 60 * 60 * 24))),\n          yReg = null;\n\n      switch (newState) {\n        case 'initial':\n          // Main data line\n          let dataLine = svg.append('path').datum(data).attr('class', 'data-line').attr('d', d3.line().x(function (d) {\n            return x(d.date) + margin.left;\n          }).y(function (d) {\n            return y(d.level) + margin.top;\n          })); // Animate data line\n\n          totalLength = dataLine.node().getTotalLength();\n          dataLine.attr(\"stroke-dasharray\", totalLength + \" \" + totalLength).attr(\"stroke-dashoffset\", totalLength).transition().duration(800).ease(d3.easeCubicOut).attr('stroke-dashoffset', 0);\n          break;\n\n        case 'linear':\n          yReg = xDays.map(d => constants.linear[0] + constants.linear[1] * d);\n          let regLine = svg.append('path').datum(data).attr('class', 'reg-line').attr('d', d3.line().x(function (d) {\n            return x(d.date) + margin.left;\n          }).y(function (d, i) {\n            return y(yReg[i]) + margin.top;\n          })),\n              regLineLabel = svg.append('g').attr('class', 'reg-line-label').attr('transform', 'translate(' + (x(data[Math.ceil(data.length * 0.52)]['date']) + margin.left + 60) + ', ' + (y(yReg[Math.ceil(yReg.length * 0.52)]) + margin.top + 20) + ')');\n          regLineLabel.style('opacity', 0).transition().duration(720).ease(d3.easeQuad).style('opacity', 1);\n          regLineLabel.append('rect').attr('class', 'reg-line-label-rect linear').attr('rx', 4).attr('ry', 4);\n          let regLineLabelText = regLineLabel.append('text').attr('class', 'reg-line-label-text');\n          regLineLabelText.append('tspan').attr('class', 'linear span').text('y = αx');\n          regLineLength = regLine.node().getTotalLength();\n          regLine.attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength).attr(\"stroke-dashoffset\", regLineLength).transition().duration(800).ease(d3.easeCubicOut).attr('stroke-dashoffset', 0);\n          d3.select('.data-line').attr('class', 'data-line faded');\n          d3.selectAll('.reg-line-label-text>tspan:not(.linear)').each(function (d) {\n            let currentSpan = d3.select(this);\n\n            if (!currentSpan.node().classList.contains('off')) {\n              currentSpan.node().classList.add('off');\n            }\n          });\n          break;\n\n        case 'quadratic':\n          yReg = xDays.map(d => constants.quadratic[0] + constants.quadratic[1] * d + constants.quadratic[2] * d ** 2);\n          d3.select('.reg-line').transition().duration(800).ease(d3.easeCubicOut).attr('d', d3.line().x(function (d) {\n            return x(d.date) + margin.left;\n          }).y(function (d, i) {\n            return y(yReg[i]) + margin.top;\n          }));\n          regLineLength = d3.select('.reg-line').node().getTotalLength();\n          d3.select('.reg-line').attr(\"stroke-dasharray\", 0).attr('stroke-dashoffset', 0);\n          d3.select('.reg-line-label-rect').attr('class', 'reg-line-label-rect quadratic');\n          d3.select('.reg-line-label-text').append('tspan').attr('class', 'quadratic span').text(' + βx\\u00b2').style('opacity', 0).transition().duration(800).ease(d3.easeQuad).style('opacity', 1);\n          d3.selectAll('.reg-line-label-text>tspan:not(.quadratic)').each(function (d) {\n            let currentSpan = d3.select(this);\n\n            if (!currentSpan.node().classList.contains('off')) {\n              currentSpan.node().classList.add('off');\n            }\n          });\n          break;\n\n        case 'cosine':\n          yReg = xDays.map(d => constants.cosine[0] + constants.cosine[1] * d + constants.cosine[2] * d ** 2 + constants.cosine[3] * Math.cos(2 * Math.PI * d / 365.25 + constants.cosine[4]));\n          d3.select('.reg-line').attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength).transition().duration(800).ease(d3.easeCubicOut).attr('d', d3.line().x(function (d) {\n            return x(d.date) + margin.left;\n          }).y(function (d, i) {\n            return y(yReg[i]) + margin.top;\n          }));\n          regLineLength = d3.select('.reg-line').node().getTotalLength();\n          d3.select('.reg-line').attr(\"stroke-dasharray\", 0).attr('stroke-dashoffset', 0);\n          d3.select('.reg-line-label-rect').attr('class', 'reg-line-label-rect cosine');\n          d3.select('.reg-line-label-text').append('tspan').attr('class', 'cosine span').text(' + cos(2πt + φ)').style('opacity', 0).transition().duration(800).ease(d3.easeQuad).style('opacity', 1);\n          d3.selectAll('.reg-line-label-text>tspan:not(.cosine)').each(function (d) {\n            let currentSpan = d3.select(this);\n\n            if (!currentSpan.node().classList.contains('off')) {\n              currentSpan.node().classList.add('off');\n            }\n          });\n          break;\n\n        default:\n      }\n    };\n\n    this.setState({\n      updateLineChart: updateLineChart\n    });\n  }\n\n  componentDidMount() {\n    d3.csv('data/weekly_in_situ_co2_mlo.csv').then(data => {\n      data.forEach(function (d) {\n        d.date = d3.timeParse('%Y-%m-%d')(d.date);\n        d.level = +d.level;\n      });\n      this.setState({\n        originalData: data\n      }, () => {\n        let animationObserver = new IntersectionObserver((entries, observer) => {\n          entries.forEach(entry => {\n            if (entry.isIntersecting) {\n              entry.target.classList.add('on');\n            }\n          });\n        }, {\n          threshold: 1\n        });\n        document.querySelectorAll('.animate').forEach(el => {\n          animationObserver.observe(el);\n        }); // let lineChartObserver = new IntersectionObserver(\n        //   (entries, observer) => {\n        //     if (entries[0].isIntersecting) {\n        //       if (entries[0].intersectionRatio === 1 && this.state.lineChartCreated) {\n        //         // this.state.updateLineChart('initial')\n        //       } else if (!this.state.lineChartCreated) {\n        //         this.createLineChart(this.state.originalData)\n        //         this.setState({lineChartCreated: true})\n        //       }\n        //     }\n        //   },\n        //   {\n        //     threshold: [0.6, 1]\n        //   })\n        // lineChartObserver.observe(document.querySelector('#line-chart'))\n\n        let lineChartScrollObserver = new IntersectionObserver((entries, observer) => {\n          entries.forEach(entry => {\n            if (entry.isIntersecting) {\n              let index = entry.target.dataset.index,\n                  el = document.querySelector('#line-chart .viz-des-text:nth-child(' + (Number(index) + 1) + ')');\n              el.classList.add('on');\n              el.classList.remove('off');\n              document.querySelectorAll('#line-chart .viz-des-text:not(:nth-child(' + (Number(index) + 1) + '))').forEach(el => {\n                if (el.classList.contains('on')) {\n                  el.classList.add('off');\n                  setTimeout(() => {\n                    el.classList.remove('on');\n                  }, 800);\n                }\n              });\n\n              if (Number(index) === 0) {\n                this.createLineChart(this.state.originalData);\n              }\n\n              this.state.updateLineChart(vizs.lineChart[index].state);\n            }\n          });\n        }, {\n          rootMargin: '0 0 -70%',\n          threshold: 1\n        });\n        document.querySelectorAll('.viz-scroll-anchor').forEach(el => {\n          lineChartScrollObserver.observe(el);\n        });\n      });\n    });\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      id: \"App\",\n      style: {\n        '--background': styles.background,\n        '--inverted-background': styles.invertedBackground,\n        '--dark': styles.dark,\n        '--inverted-dark': styles.invertedDark,\n        '--normal': styles.normal,\n        '--light': styles.light,\n        '--line': styles.line,\n        '--theme': styles.theme,\n        '--theme-readable': styles.themeReadable\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 388\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"hero-wrap\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 401\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      className: \"hero-text\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 402\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      className: \"hero-span span-1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 403\n      },\n      __self: this\n    }, \"C\"), React.createElement(\"span\", {\n      className: \"hero-span span-2\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 404\n      },\n      __self: this\n    }, \"O\"), React.createElement(\"sub\", {\n      className: \"hero-span span-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 405\n      },\n      __self: this\n    }, \"2\")), React.createElement(\"p\", {\n      className: \"hero-des\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 407\n      },\n      __self: this\n    }, \"An exploration into new formats for data visualization, with CO\", React.createElement(\"sub\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 408\n      },\n      __self: this\n    }, \"2\"), \" measurements from the Mauna Loa Observatory in Hawaii.\")), React.createElement(\"div\", {\n      className: \"section-wrap line-chart\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 411\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"limit-box\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 412\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      className: \"header limited\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 413\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      className: \"header-span animate right\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 414\n      },\n      __self: this\n    }, \"A rapid\"), React.createElement(\"span\", {\n      className: \"header-span animate left\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 415\n      },\n      __self: this\n    }, \"increase.\")), React.createElement(\"p\", {\n      className: \"para limited animate blur\",\n      style: {\n        '--animation-speed': '800ms',\n        '--animation-delay': '800ms'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 417\n      },\n      __self: this\n    }, \"A simple line plot can show us how the CO\", React.createElement(\"sub\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 423\n      },\n      __self: this\n    }, \"2\"), \" levels (measured in ppm - parts per million) has changed since the first recordings in 1980.\")), React.createElement(\"div\", {\n      className: \"viz-outer-wrap\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 426\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"viz-wrap\",\n      id: \"line-chart\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 427\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"viz-des-wrap\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 428\n      },\n      __self: this\n    }, vizs.lineChart.map((des, index) => {\n      return React.createElement(\"p\", {\n        className: \"viz-des-text\",\n        key: index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 431\n        },\n        __self: this\n      }, des.des);\n    }))), React.createElement(\"div\", {\n      className: \"viz-scroll-box\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 436\n      },\n      __self: this\n    }, vizs.lineChart.map((des, index) => {\n      return React.createElement(\"div\", {\n        className: \"viz-scroll-anchor\",\n        \"data-index\": index,\n        key: index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 439\n        },\n        __self: this\n      });\n    })))));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/vu/Documents/Work/Repositories/co2/src/App.js"],"names":["React","Component","d3","constants","linear","quadratic","cosine","styles","background","invertedBackground","dark","invertedDark","normal","light","line","theme","vizs","lineChart","state","des","App","constructor","props","originalData","lineChartCreated","createLineChart","bind","data","margin","top","right","bottom","left","width","window","innerWidth","height","innerHeight","svg","select","append","attr","x","scaleTime","domain","extent","d","i","date","range","nice","y","scaleLinear","level","totalLength","call","axisBottom","ticks","tickSize","tickFormat","selectAll","each","transition","duration","ease","easeCubicOut","axisLeft","style","easeQuad","tickPadding","axisRight","easeQuadOut","updateLineChart","newState","regLineLength","minDate","min","xDays","map","Math","ceil","getTime","yReg","dataLine","datum","node","getTotalLength","regLine","regLineLabel","length","regLineLabelText","text","currentSpan","classList","contains","add","cos","PI","setState","componentDidMount","csv","then","forEach","timeParse","animationObserver","IntersectionObserver","entries","observer","entry","isIntersecting","target","threshold","document","querySelectorAll","el","observe","lineChartScrollObserver","index","dataset","querySelector","Number","remove","setTimeout","rootMargin","render","themeReadable"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport * as d3 from 'd3'\n\nconst constants = {\n  linear: [\n    306.06644452,\n    0.00430901514\n  ],\n  quadratic: [\n    314.574751,\n    0.00210065413,\n    0.0000000973625567\n  ],\n  cosine: [\n    314.569048,\n    0.00210632696,\n    0.0000000970576557,\n    2.86111474,\n    -0.554076698]\n},\nstyles = {\n  background: '#FFFFFF',\n  invertedBackground: '#060608',\n  dark: '#121214',\n  invertedDark: '#FFFFFF',\n  normal: '#444455',\n  light: '#888899',\n  line: '#E8E8E9',\n  theme: '#4ba824'\n},\nvizs = {\n  lineChart: [\n    {\n      state: 'initial',\n      des: 'The data looks like this.'\n    },\n    {\n      state: 'linear',\n      des: 'There is a clear and consistent upward trend through the years.'\n    },\n    {\n      state: 'quadratic',\n      des: 'But a quadratic trend line would be a better fit.'\n    },\n    {\n      state: 'cosine',\n      des: 'The levels also have a seasonal component. This could be modeled by adding a cosine term to the function.'\n    }\n  ]\n}\n\nclass App extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      originalData: [],\n      lineChartCreated: false\n    }\n    this.createLineChart = this.createLineChart.bind(this)\n  }\n  createLineChart(data) {\n    let margin = {top: 20, right: 60, bottom: 40, left: 0},\n      width = window.innerWidth - 440,\n      height = window.innerHeight - 200,\n      innerWidth = width - margin.left - margin.right,\n      innerHeight = height - margin.top - margin.bottom,\n      svg = d3.select('#line-chart')\n      .append('svg')\n        .attr('width', width)\n        .attr('height', height)\n        .attr('class', 'viz'),\n      x = d3.scaleTime()\n      .domain(d3.extent(data, (d, i) => {return d.date}))\n      .range([0, innerWidth])\n      .nice(),\n      y = d3.scaleLinear()\n      .domain(d3.extent(data, (d, i) => {return d.level}))\n      .range([innerHeight, 0])\n      .nice(),\n      totalLength = null\n\n    // Grid lines\n    svg.append('g')\n      .attr('class', 'y grid')\n      .attr('transform', 'translate(' + margin.left + ', ' + height + ')')\n      .call(d3.axisBottom(x)\n          .ticks(5)\n          .tickSize(-height)\n          .tickFormat('')\n      )\n    d3.selectAll('.y.grid>.tick').each(function(d, i) {\n      d3.select(this).attr(\"stroke-dasharray\", height + \" \" + height)\n        .attr(\"stroke-dashoffset\", height)\n        .transition()\n          .duration(800)\n          .ease(d3.easeCubicOut)\n          .attr('stroke-dashoffset', function() {\n            if (i%2 === 0) {\n              return 0\n            } else {\n              return 2*height\n            }\n          })\n    })\n    svg.append('g')\n      .attr('class', 'x grid')\n      .attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')')\n      .call(d3.axisLeft(y)\n          .ticks(5)\n          .tickSize(-width)\n          .tickFormat('')\n      )\n    d3.selectAll('.x.grid>.tick').each(function(d, i) {\n      d3.select(this).attr(\"stroke-dasharray\", width + \" \" + width)\n        .attr(\"stroke-dashoffset\", width)\n        .transition()\n          .duration(800)\n          .ease(d3.easeCubicOut)\n          .attr('stroke-dashoffset', function() {\n            if (i%2 === 0) {\n              return 0\n            } else {\n              return 2*width\n            }\n          })\n    })\n\n    // Axes\n    svg.append('g')\n      .attr('class', 'x axis')\n      .attr('transform', 'translate(' + margin.left + ', ' + (innerHeight + margin.top) + ')')\n      .style(\"opacity\", 0)\n      .transition()\n        .duration(800)\n        .ease(d3.easeQuad)\n        .style('opacity', 1)\n      .call(d3.axisBottom(x)\n        .ticks(5)\n        .tickSize(0)\n        .tickPadding(24))\n    svg.append('g')\n      .attr('class', 'y axis')\n      .attr('transform', 'translate(' + (innerWidth + margin.left) + ', ' + margin.top + ')')\n      .style(\"opacity\", 0)\n      .transition()\n        .duration(800)\n        .ease(d3.easeQuad)\n        .style('opacity', 1)\n      .call(d3.axisRight(y)\n        .ticks(5)\n        .tickSize(0)\n        .tickPadding(32))\n    svg.append('line')\n      .attr('class', 'bottom-axis')\n      .attr(\"x1\", 0)\n      .attr(\"y1\", height - margin.bottom)\n      .attr(\"x2\", width)\n      .attr(\"y2\", height - margin.bottom)\n      .style(\"opacity\", 0)\n      .transition()\n        .duration(800)\n        .ease(d3.easeQuadOut)\n        .style('opacity', 1)\n\n\n    let updateLineChart = function(newState) {\n      let regLineLength = null,\n        minDate = d3.min(data, function(d) {return d.date}),\n        xDays = data.map(d => Math.ceil((d.date.getTime() - minDate.getTime())/(1000*60*60*24))),\n        yReg = null\n      switch(newState) {\n        case 'initial':\n          // Main data line\n          let dataLine = svg.append('path')\n            .datum(data)\n            .attr('class', 'data-line')\n            .attr('d', d3.line()\n              .x(function(d) { return x(d.date) + margin.left })\n              .y(function(d) { return y(d.level) + margin.top })\n            )\n\n          // Animate data line\n          totalLength = dataLine.node().getTotalLength()\n          dataLine.attr(\"stroke-dasharray\", totalLength + \" \" + totalLength)\n            .attr(\"stroke-dashoffset\", totalLength)\n            .transition()\n              .duration(800)\n              .ease(d3.easeCubicOut)\n              .attr('stroke-dashoffset', 0)\n          break\n        case 'linear':\n          yReg = xDays.map(d => constants.linear[0] + constants.linear[1]*d)\n          let regLine = svg.append('path')\n            .datum(data)\n            .attr('class', 'reg-line')\n            .attr('d', d3.line()\n              .x(function(d) { return x(d.date) + margin.left })\n              .y(function(d, i) {return y(yReg[i]) + margin.top })\n          ),\n          regLineLabel = svg.append('g')\n            .attr('class', 'reg-line-label')\n            .attr('transform',\n              'translate('\n              + (x(data[Math.ceil(data.length*0.52)]['date']) + margin.left + 60)\n              + ', '\n              + (y(yReg[Math.ceil(yReg.length*0.52)]) + margin.top + 20)\n              + ')'\n            )\n          regLineLabel.style('opacity', 0)\n            .transition()\n              .duration(720)\n              .ease(d3.easeQuad)\n              .style('opacity', 1)\n          regLineLabel.append('rect')\n            .attr('class', 'reg-line-label-rect linear')\n            .attr('rx', 4)\n            .attr('ry', 4)\n          let regLineLabelText = regLineLabel.append('text')\n              .attr('class', 'reg-line-label-text')\n          regLineLabelText.append('tspan')\n              .attr('class', 'linear span')\n              .text('y = αx')\n          regLineLength = regLine.node().getTotalLength()\n          regLine.attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength)\n            .attr(\"stroke-dashoffset\", regLineLength)\n            .transition()\n              .duration(800)\n              .ease(d3.easeCubicOut)\n              .attr('stroke-dashoffset', 0)\n          d3.select('.data-line').attr('class', 'data-line faded')\n          d3.selectAll('.reg-line-label-text>tspan:not(.linear)')\n            .each(function(d) {\n              let currentSpan = d3.select(this)\n              if (!currentSpan.node().classList.contains('off')) {\n                currentSpan.node().classList.add('off')\n              }\n            })\n          break\n        case 'quadratic':\n          yReg = xDays.map(d => constants.quadratic[0] + constants.quadratic[1]*d + constants.quadratic[2]*d**2)\n          d3.select('.reg-line').transition()\n            .duration(800)\n            .ease(d3.easeCubicOut)\n            .attr('d', d3.line()\n              .x(function(d) { return x(d.date) + margin.left })\n              .y(function(d, i) {return y(yReg[i]) + margin.top })\n            )\n          regLineLength = d3.select('.reg-line').node().getTotalLength()\n          d3.select('.reg-line').attr(\"stroke-dasharray\", 0)\n            .attr('stroke-dashoffset', 0)\n          d3.select('.reg-line-label-rect')\n            .attr('class', 'reg-line-label-rect quadratic')\n          d3.select('.reg-line-label-text').append('tspan')\n            .attr('class', 'quadratic span')\n            .text(' + βx\\u00b2')\n            .style('opacity', 0)\n              .transition()\n                .duration(800)\n                .ease(d3.easeQuad)\n                .style('opacity', 1)\n          d3.selectAll('.reg-line-label-text>tspan:not(.quadratic)')\n            .each(function(d) {\n              let currentSpan = d3.select(this)\n              if (!currentSpan.node().classList.contains('off')) {\n                currentSpan.node().classList.add('off')\n              }\n            })\n          break\n        case 'cosine':\n          yReg = xDays.map(d => constants.cosine[0]\n            + constants.cosine[1]*d\n            + constants.cosine[2]*d**2\n            + constants.cosine[3]*Math.cos(2*Math.PI*d/365.25 + constants.cosine[4])\n          )\n          d3.select('.reg-line').attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength)\n            .transition()\n              .duration(800)\n              .ease(d3.easeCubicOut)\n              .attr('d', d3.line()\n                .x(function(d) { return x(d.date) + margin.left })\n                .y(function(d, i) {return y(yReg[i]) + margin.top })\n            )\n          regLineLength = d3.select('.reg-line').node().getTotalLength()\n          d3.select('.reg-line').attr(\"stroke-dasharray\", 0)\n            .attr('stroke-dashoffset', 0)\n          d3.select('.reg-line-label-rect')\n            .attr('class', 'reg-line-label-rect cosine')\n          d3.select('.reg-line-label-text').append('tspan')\n            .attr('class', 'cosine span')\n            .text(' + cos(2πt + φ)')\n            .style('opacity', 0)\n              .transition()\n                .duration(800)\n                .ease(d3.easeQuad)\n                .style('opacity', 1)\n          d3.selectAll('.reg-line-label-text>tspan:not(.cosine)')\n            .each(function(d) {\n              let currentSpan = d3.select(this)\n              if (!currentSpan.node().classList.contains('off')) {\n                currentSpan.node().classList.add('off')\n              }\n            })\n          break\n        default:\n      }\n    }\n    this.setState({\n      updateLineChart: updateLineChart\n    })\n  }\n  componentDidMount() {\n    d3.csv('data/weekly_in_situ_co2_mlo.csv').then(data => {\n      data.forEach(function(d) {\n        d.date = d3.timeParse('%Y-%m-%d')(d.date)\n        d.level = +d.level\n      })\n      this.setState({\n        originalData: data\n      }, () => {\n        let animationObserver = new IntersectionObserver(\n          (entries, observer) => {\n            entries.forEach((entry) => {\n              if (entry.isIntersecting) {\n                entry.target.classList.add('on')\n              }\n            })\n          },\n          {\n            threshold: 1\n          })\n        document.querySelectorAll('.animate').forEach(el => {\n          animationObserver.observe(el)\n        })\n\n        // let lineChartObserver = new IntersectionObserver(\n        //   (entries, observer) => {\n        //     if (entries[0].isIntersecting) {\n        //       if (entries[0].intersectionRatio === 1 && this.state.lineChartCreated) {\n        //         // this.state.updateLineChart('initial')\n        //       } else if (!this.state.lineChartCreated) {\n        //         this.createLineChart(this.state.originalData)\n        //         this.setState({lineChartCreated: true})\n        //       }\n        //     }\n        //   },\n        //   {\n        //     threshold: [0.6, 1]\n        //   })\n        // lineChartObserver.observe(document.querySelector('#line-chart'))\n\n        let lineChartScrollObserver = new IntersectionObserver(\n          (entries, observer) => {\n            entries.forEach((entry) => {\n              if (entry.isIntersecting) {\n                let index = entry.target.dataset.index,\n                  el = document.querySelector('#line-chart .viz-des-text:nth-child(' + (Number(index) + 1) + ')')\n                el.classList.add('on')\n                el.classList.remove('off')\n                document.querySelectorAll('#line-chart .viz-des-text:not(:nth-child(' + (Number(index) + 1) + '))').forEach(el => {\n                  if (el.classList.contains('on')) {\n                    el.classList.add('off')\n                    setTimeout(() => {\n                      el.classList.remove('on')\n                    }, 800)\n                  }\n                })\n                if (Number(index) === 0) {\n                  this.createLineChart(this.state.originalData)\n                }\n                this.state.updateLineChart(vizs.lineChart[index].state)\n              }\n            })\n          },\n          {\n            rootMargin: '0 0 -70%',\n            threshold: 1\n          })\n          document.querySelectorAll('.viz-scroll-anchor').forEach(el => {\n            lineChartScrollObserver.observe(el)\n          })\n\n      })\n    })\n  }\n  render() {\n    return (\n      <div\n        id=\"App\"\n        style={{\n            '--background': styles.background,\n            '--inverted-background': styles.invertedBackground,\n            '--dark': styles.dark,\n            '--inverted-dark': styles.invertedDark,\n            '--normal': styles.normal,\n            '--light': styles.light,\n            '--line': styles.line,\n            '--theme': styles.theme,\n            '--theme-readable': styles.themeReadable\n          }}>\n          <div className=\"hero-wrap\">\n            <h1 className=\"hero-text\">\n              <span className=\"hero-span span-1\">C</span>\n              <span className=\"hero-span span-2\">O</span>\n              <sub className=\"hero-span span-3\">2</sub>\n            </h1>\n            <p className=\"hero-des\">\n              An exploration into new formats for data visualization, with CO<sub>2</sub> measurements from the Mauna Loa Observatory in Hawaii.\n            </p>\n          </div>\n          <div className=\"section-wrap line-chart\">\n            <div className=\"limit-box\">\n              <h2 className=\"header limited\">\n                  <span className=\"header-span animate right\">A rapid</span>\n                  <span className=\"header-span animate left\">increase.</span>\n              </h2>\n              <p\n                className=\"para limited animate blur\"\n                style={{\n                  '--animation-speed': '800ms',\n                  '--animation-delay': '800ms'\n              }}>\n                A simple line plot can show us how the CO<sub>2</sub> levels (measured in ppm - parts per million) has changed since the first recordings in 1980.\n              </p>\n            </div>\n            <div className=\"viz-outer-wrap\">\n              <div className=\"viz-wrap\" id=\"line-chart\">\n                <div className=\"viz-des-wrap\">\n                  {vizs.lineChart.map((des, index) => {\n                    return (\n                      <p className=\"viz-des-text\" key={index}>{des.des}</p>\n                    )\n                  })}\n                </div>\n              </div>\n              <div className=\"viz-scroll-box\">\n                {vizs.lineChart.map((des, index) => {\n                  return (\n                    <div className=\"viz-scroll-anchor\" data-index={index} key={index}></div>\n                  )\n                })}\n              </div>\n            </div>\n          </div>\n      </div>\n    )\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}