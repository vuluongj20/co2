{"ast":null,"code":"var _jsxFileName = \"/Users/vu/Documents/Work/Repositories/co2/src/App.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport * as d3 from 'd3';\nconst constants = {\n  linear: [306.06644452, 0.00430901514],\n  quadratic: [314.574751, 0.00210065413, 0.0000000973625567],\n  cosine: [314.569048, 0.00210632696, 0.0000000970576557, 2.86111474, -0.554076698]\n};\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      originalData: [],\n      styles: {\n        dark: '#333344',\n        normal: '#555566',\n        light: '#999999',\n        line: '#EEEEEE',\n        theme: '#4BA824'\n      },\n      chartState: 'initial'\n    };\n  }\n\n  createLineChart(data) {\n    let x = d3.scaleTime().domain(d3.extent(data, (d, i) => {\n      return d.date;\n    })).range([0, innerWidth]).nice(),\n        y = d3.scaleLinear().domain(d3.extent(data, (d, i) => {\n      return d.level;\n    })).range([innerHeight, 0]).nice(),\n        totalLength = null; // Grid lines\n\n    svg.append('g').attr('class', 'y grid').attr('transform', 'translate(' + margin.left + ', ' + height + ')').call(d3.axisBottom(x).ticks(5).tickSize(-height).tickFormat(''));\n    svg.append('g').attr('class', 'x grid').attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')').call(d3.axisLeft(y).ticks(5).tickSize(-width).tickFormat('')); // Axes\n\n    svg.append('g').attr('class', 'x axis').attr('transform', 'translate(' + margin.left + ', ' + (innerHeight + margin.top) + ')').call(d3.axisBottom(x).ticks(5).tickSize(0).tickPadding(24));\n    svg.append('g').attr('class', 'y axis').attr('transform', 'translate(' + (innerWidth + margin.left) + ', ' + margin.top + ')').call(d3.axisRight(y).ticks(5).tickSize(0).tickPadding(32));\n    svg.append('line').attr('class', 'bottom-axis').attr(\"x1\", 0).attr(\"y1\", height - margin.bottom).attr(\"x2\", width).attr(\"y2\", height - margin.bottom); // Main data line\n\n    let dataLine = svg.append('path').datum(data).attr('class', 'data-line').attr('d', d3.line().x(function (d) {\n      return x(d.date) + margin.left;\n    }).y(function (d) {\n      return y(d.level) + margin.top;\n    })); // Animate data line\n\n    totalLength = dataLine.node().getTotalLength();\n    dataLine.attr(\"stroke-dasharray\", totalLength + \" \" + totalLength).attr(\"stroke-dashoffset\", totalLength).transition().delay(400).duration(600).ease(d3.easeCubicOut).attr('stroke-dashoffset', 0);\n\n    let updateReg = function (newState) {\n      let regLineLength = null,\n          minDate = d3.min(data, function (d) {\n        return d.date;\n      }),\n          xDays = data.map(d => Math.ceil((d.date.getTime() - minDate.getTime()) / (1000 * 60 * 60 * 24))),\n          yReg = null;\n\n      switch (newState) {\n        case 'linear':\n          yReg = xDays.map(d => constants.linear[0] + constants.linear[1] * d);\n          let regLine = svg.append('path').datum(data).attr('class', 'reg-line').attr('d', d3.line().x(function (d) {\n            return x(d.date) + margin.left;\n          }).y(function (d, i) {\n            return y(yReg[i]) + margin.top;\n          })),\n              regLineLabel = svg.append('g').attr('class', 'reg-line-label').attr('transform', 'translate(' + (x(data[Math.ceil(data.length * 0.52)]['date']) + margin.left + 60) + ', ' + (y(yReg[Math.ceil(yReg.length * 0.52)]) + margin.top + 20) + ')');\n          regLineLabel.style('opacity', 0).transition().duration(600).ease(d3.easeQuadOut).style('opacity', 1);\n          regLineLabel.append('rect').attr('class', 'reg-line-label-rect linear');\n          let regLineLabelText = regLineLabel.append('text').attr('class', 'reg-line-label-text');\n          regLineLabelText.append('tspan').attr('class', 'linear span').text('y = αx');\n          regLineLength = regLine.node().getTotalLength();\n          regLine.attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength).attr(\"stroke-dashoffset\", regLineLength).transition().duration(600).ease(d3.easeQuadOut).attr('stroke-dashoffset', 0);\n          dataLine.node().style.stroke = 'var(--line)';\n          d3.selectAll('.reg-line-label-text>tspan:not(.linear)').each(function (d) {\n            let currentSpan = d3.select(this);\n\n            if (!currentSpan.node().classList.contains('off')) {\n              currentSpan.node().classList.add('off');\n            }\n          });\n          break;\n\n        case 'quadratic':\n          yReg = xDays.map(d => constants.quadratic[0] + constants.quadratic[1] * d + constants.quadratic[2] * d ** 2);\n          d3.select('.reg-line').transition().duration(600).ease(d3.easeQuadOut).attr('d', d3.line().x(function (d) {\n            return x(d.date) + margin.left;\n          }).y(function (d, i) {\n            return y(yReg[i]) + margin.top;\n          }));\n          regLineLength = d3.select('.reg-line').node().getTotalLength();\n          d3.select('.reg-line').attr(\"stroke-dasharray\", 0).attr('stroke-dashoffset', 0);\n          d3.select('.reg-line-label-rect').attr('class', 'reg-line-label-rect quadratic');\n          d3.select('.reg-line-label-text').append('tspan').attr('class', 'quadratic span').text(' + βx\\u00b2').style('opacity', 0).transition().duration(600).ease(d3.easeQuadOut).style('opacity', 1);\n          d3.selectAll('.reg-line-label-text>tspan:not(.quadratic)').each(function (d) {\n            let currentSpan = d3.select(this);\n\n            if (!currentSpan.node().classList.contains('off')) {\n              currentSpan.node().classList.add('off');\n            }\n          });\n          break;\n\n        case 'cosine':\n          yReg = xDays.map(d => constants.cosine[0] + constants.cosine[1] * d + constants.cosine[2] * d ** 2 + constants.cosine[3] * Math.cos(2 * Math.PI * d / 365.25 + constants.cosine[4]));\n          d3.select('.reg-line').attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength).transition().duration(600).ease(d3.easeCubicOut).attr('d', d3.line().x(function (d) {\n            return x(d.date) + margin.left;\n          }).y(function (d, i) {\n            return y(yReg[i]) + margin.top;\n          }));\n          regLineLength = d3.select('.reg-line').node().getTotalLength();\n          d3.select('.reg-line').attr(\"stroke-dasharray\", 0).attr('stroke-dashoffset', 0);\n          d3.select('.reg-line-label-rect').attr('class', 'reg-line-label-rect cosine');\n          d3.select('.reg-line-label-text').append('tspan').attr('class', 'cosine span').text(' + cos(2πt + φ)').style('opacity', 0).transition().duration(600).ease(d3.easeCubicOut).style('opacity', 1);\n          d3.selectAll('.reg-line-label-text>tspan:not(.cosine)').each(function (d) {\n            let currentSpan = d3.select(this);\n\n            if (!currentSpan.node().classList.contains('off')) {\n              currentSpan.node().classList.add('off');\n            }\n          });\n          break;\n\n        default:\n      }\n    };\n\n    this.setState({\n      updateReg: updateReg\n    });\n  }\n\n  componentDidMount() {\n    let margin = {\n      top: 20,\n      right: 60,\n      bottom: 40,\n      left: 0\n    },\n        width = 800,\n        height = 600,\n        innerWidth = width - margin.left - margin.right,\n        innerHeight = height - margin.top - margin.bottom,\n        svg = d3.select('#App').append('svg').attr('width', width).attr('height', height);\n    d3.csv('data/weekly_in_situ_co2_mlo.csv').then(data => {\n      data.forEach(function (d) {\n        d.date = d3.timeParse('%Y-%m-%d')(d.date);\n        d.level = +d.level;\n      });\n      this.setState({\n        originalData: data\n      }, () => {});\n    });\n    window.addEventListener('click', () => {\n      if (this.state.chartState === 'initial') {\n        this.setState({\n          chartState: 'linear'\n        }, () => this.state.updateReg('linear'));\n      } else if (this.state.chartState === 'linear') {\n        this.setState({\n          chartState: 'quadratic'\n        }, () => this.state.updateReg('quadratic'));\n      } else if (this.state.chartState === 'quadratic') {\n        this.setState({\n          chartState: 'cosine'\n        }, () => this.state.updateReg('cosine'));\n      }\n    });\n  }\n\n  render() {\n    let styles = this.state.styles;\n    return React.createElement(\"div\", {\n      id: \"App\",\n      style: {\n        '--dark': styles.dark,\n        '--normal': styles.normal,\n        '--light': styles.light,\n        '--line': styles.line,\n        '--theme': styles.theme,\n        '--theme-readable': styles.themeReadable\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274\n      },\n      __self: this\n    });\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/vu/Documents/Work/Repositories/co2/src/App.js"],"names":["React","Component","d3","constants","linear","quadratic","cosine","App","constructor","props","state","originalData","styles","dark","normal","light","line","theme","chartState","createLineChart","data","x","scaleTime","domain","extent","d","i","date","range","innerWidth","nice","y","scaleLinear","level","innerHeight","totalLength","svg","append","attr","margin","left","height","call","axisBottom","ticks","tickSize","tickFormat","top","axisLeft","width","tickPadding","axisRight","bottom","dataLine","datum","node","getTotalLength","transition","delay","duration","ease","easeCubicOut","updateReg","newState","regLineLength","minDate","min","xDays","map","Math","ceil","getTime","yReg","regLine","regLineLabel","length","style","easeQuadOut","regLineLabelText","text","stroke","selectAll","each","currentSpan","select","classList","contains","add","cos","PI","setState","componentDidMount","right","csv","then","forEach","timeParse","window","addEventListener","render","themeReadable"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport * as d3 from 'd3'\n\nconst constants = {\n  linear: [\n    306.06644452,\n    0.00430901514\n  ],\n  quadratic: [\n    314.574751,\n    0.00210065413,\n    0.0000000973625567\n  ],\n  cosine: [\n    314.569048,\n    0.00210632696,\n    0.0000000970576557,\n    2.86111474,\n    -0.554076698]\n}\n\nclass App extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      originalData: [],\n      styles: {\n        dark: '#333344',\n        normal: '#555566',\n        light: '#999999',\n        line: '#EEEEEE',\n        theme: '#4BA824'\n      },\n      chartState: 'initial'\n    }\n  }\n  createLineChart(data) {\n    let x = d3.scaleTime()\n      .domain(d3.extent(data, (d, i) => {return d.date}))\n      .range([0, innerWidth])\n      .nice(),\n      y = d3.scaleLinear()\n      .domain(d3.extent(data, (d, i) => {return d.level}))\n      .range([innerHeight, 0])\n      .nice(),\n      totalLength = null\n\n    // Grid lines\n    svg.append('g')\n      .attr('class', 'y grid')\n      .attr('transform', 'translate(' + margin.left + ', ' + height + ')')\n      .call(d3.axisBottom(x)\n          .ticks(5)\n          .tickSize(-height)\n          .tickFormat('')\n      )\n    svg.append('g')\n      .attr('class', 'x grid')\n      .attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')')\n      .call(d3.axisLeft(y)\n          .ticks(5)\n          .tickSize(-width)\n          .tickFormat('')\n      )\n\n    // Axes\n    svg.append('g')\n      .attr('class', 'x axis')\n      .attr('transform', 'translate(' + margin.left + ', ' + (innerHeight + margin.top) + ')')\n      .call(d3.axisBottom(x)\n        .ticks(5)\n        .tickSize(0)\n        .tickPadding(24))\n    svg.append('g')\n      .attr('class', 'y axis')\n      .attr('transform', 'translate(' + (innerWidth + margin.left) + ', ' + margin.top + ')')\n      .call(d3.axisRight(y)\n        .ticks(5)\n        .tickSize(0)\n        .tickPadding(32))\n    svg.append('line')\n      .attr('class', 'bottom-axis')\n      .attr(\"x1\", 0)\n      .attr(\"y1\", height - margin.bottom)\n      .attr(\"x2\", width)\n      .attr(\"y2\", height - margin.bottom)\n\n    // Main data line\n    let dataLine = svg.append('path')\n      .datum(data)\n      .attr('class', 'data-line')\n      .attr('d', d3.line()\n        .x(function(d) { return x(d.date) + margin.left })\n        .y(function(d) { return y(d.level) + margin.top })\n      )\n\n    // Animate data line\n    totalLength = dataLine.node().getTotalLength()\n    dataLine.attr(\"stroke-dasharray\", totalLength + \" \" + totalLength)\n      .attr(\"stroke-dashoffset\", totalLength)\n      .transition()\n        .delay(400)\n        .duration(600)\n        .ease(d3.easeCubicOut)\n        .attr('stroke-dashoffset', 0)\n\n    let updateReg = function(newState) {\n      let regLineLength = null,\n        minDate = d3.min(data, function(d) {return d.date}),\n        xDays = data.map(d => Math.ceil((d.date.getTime() - minDate.getTime())/(1000*60*60*24))),\n        yReg = null\n      switch(newState) {\n        case 'linear':\n          yReg = xDays.map(d => constants.linear[0] + constants.linear[1]*d)\n          let regLine = svg.append('path')\n            .datum(data)\n            .attr('class', 'reg-line')\n            .attr('d', d3.line()\n              .x(function(d) { return x(d.date) + margin.left })\n              .y(function(d, i) {return y(yReg[i]) + margin.top })\n          ),\n          regLineLabel = svg.append('g')\n            .attr('class', 'reg-line-label')\n            .attr('transform',\n              'translate('\n              + (x(data[Math.ceil(data.length*0.52)]['date']) + margin.left + 60)\n              + ', '\n              + (y(yReg[Math.ceil(yReg.length*0.52)]) + margin.top + 20)\n              + ')'\n            )\n          regLineLabel.style('opacity', 0)\n            .transition()\n              .duration(600)\n              .ease(d3.easeQuadOut)\n              .style('opacity', 1)\n          regLineLabel.append('rect')\n            .attr('class', 'reg-line-label-rect linear')\n          let regLineLabelText = regLineLabel.append('text')\n              .attr('class', 'reg-line-label-text')\n          regLineLabelText.append('tspan')\n              .attr('class', 'linear span')\n              .text('y = αx')\n          regLineLength = regLine.node().getTotalLength()\n          regLine.attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength)\n            .attr(\"stroke-dashoffset\", regLineLength)\n            .transition()\n              .duration(600)\n              .ease(d3.easeQuadOut)\n              .attr('stroke-dashoffset', 0)\n          dataLine.node().style.stroke = 'var(--line)'\n          d3.selectAll('.reg-line-label-text>tspan:not(.linear)')\n            .each(function(d) {\n              let currentSpan = d3.select(this)\n              if (!currentSpan.node().classList.contains('off')) {\n                currentSpan.node().classList.add('off')\n              }\n            })\n          break\n        case 'quadratic':\n          yReg = xDays.map(d => constants.quadratic[0] + constants.quadratic[1]*d + constants.quadratic[2]*d**2)\n          d3.select('.reg-line').transition()\n            .duration(600)\n            .ease(d3.easeQuadOut)\n            .attr('d', d3.line()\n              .x(function(d) { return x(d.date) + margin.left })\n              .y(function(d, i) {return y(yReg[i]) + margin.top })\n            )\n          regLineLength = d3.select('.reg-line').node().getTotalLength()\n          d3.select('.reg-line').attr(\"stroke-dasharray\", 0)\n            .attr('stroke-dashoffset', 0)\n          d3.select('.reg-line-label-rect')\n            .attr('class', 'reg-line-label-rect quadratic')\n          d3.select('.reg-line-label-text').append('tspan')\n            .attr('class', 'quadratic span')\n            .text(' + βx\\u00b2')\n            .style('opacity', 0)\n              .transition()\n                .duration(600)\n                .ease(d3.easeQuadOut)\n                .style('opacity', 1)\n          d3.selectAll('.reg-line-label-text>tspan:not(.quadratic)')\n            .each(function(d) {\n              let currentSpan = d3.select(this)\n              if (!currentSpan.node().classList.contains('off')) {\n                currentSpan.node().classList.add('off')\n              }\n            })\n          break\n        case 'cosine':\n          yReg = xDays.map(d => constants.cosine[0]\n            + constants.cosine[1]*d\n            + constants.cosine[2]*d**2\n            + constants.cosine[3]*Math.cos(2*Math.PI*d/365.25 + constants.cosine[4])\n          )\n          d3.select('.reg-line').attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength)\n            .transition()\n              .duration(600)\n              .ease(d3.easeCubicOut)\n              .attr('d', d3.line()\n                .x(function(d) { return x(d.date) + margin.left })\n                .y(function(d, i) {return y(yReg[i]) + margin.top })\n            )\n          regLineLength = d3.select('.reg-line').node().getTotalLength()\n          d3.select('.reg-line').attr(\"stroke-dasharray\", 0)\n            .attr('stroke-dashoffset', 0)\n          d3.select('.reg-line-label-rect')\n            .attr('class', 'reg-line-label-rect cosine')\n          d3.select('.reg-line-label-text').append('tspan')\n            .attr('class', 'cosine span')\n            .text(' + cos(2πt + φ)')\n            .style('opacity', 0)\n              .transition()\n                .duration(600)\n                .ease(d3.easeCubicOut)\n                .style('opacity', 1)\n          d3.selectAll('.reg-line-label-text>tspan:not(.cosine)')\n            .each(function(d) {\n              let currentSpan = d3.select(this)\n              if (!currentSpan.node().classList.contains('off')) {\n                currentSpan.node().classList.add('off')\n              }\n            })\n          break\n        default:\n      }\n    }\n    this.setState({\n      updateReg: updateReg\n    })\n  }\n  componentDidMount() {\n    let margin = {top: 20, right: 60, bottom: 40, left: 0},\n      width = 800,\n      height = 600,\n      innerWidth = width - margin.left - margin.right,\n      innerHeight = height - margin.top - margin.bottom,\n      svg = d3.select('#App')\n      .append('svg')\n        .attr('width', width)\n        .attr('height', height)\n\n    d3.csv('data/weekly_in_situ_co2_mlo.csv').then(data => {\n      data.forEach(function(d) {\n        d.date = d3.timeParse('%Y-%m-%d')(d.date)\n        d.level = +d.level\n      })\n      this.setState({\n        originalData: data\n      }, () => {\n\n      })\n    })\n\n    window.addEventListener('click', () => {\n      if (this.state.chartState === 'initial') {\n        this.setState({\n          chartState: 'linear'\n        }, () => this.state.updateReg('linear'))\n      } else if (this.state.chartState === 'linear') {\n        this.setState({\n          chartState: 'quadratic'\n        }, () => this.state.updateReg('quadratic'))\n      } else if (this.state.chartState === 'quadratic') {\n        this.setState({\n          chartState: 'cosine'\n        }, () => this.state.updateReg('cosine'))\n      }\n    })\n  }\n  render() {\n    let styles = this.state.styles\n    return (\n      <div\n        id=\"App\"\n        style={{\n            '--dark': styles.dark,\n            '--normal': styles.normal,\n            '--light': styles.light,\n            '--line': styles.line,\n            '--theme': styles.theme,\n            '--theme-readable': styles.themeReadable\n          }}>\n      </div>\n    )\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}