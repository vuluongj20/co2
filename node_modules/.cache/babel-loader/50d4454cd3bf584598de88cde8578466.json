{"ast":null,"code":"var _jsxFileName = \"/Users/vu/Documents/Work/Repositories/co2/src/components/section/viz/LineChart.js\";\nimport React, { Component } from 'react';\nimport './LineChart.css';\nimport * as d3 from 'd3';\n\nclass LineChart extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      vizCreated: false,\n      updateFunc: null\n    };\n    this.createViz = this.createViz.bind(this);\n    this.vizRef = React.createRef();\n  }\n\n  createViz(data) {\n    let margin = {\n      top: 20,\n      right: 60,\n      bottom: 40,\n      left: 0\n    },\n        width = window.innerWidth - 440,\n        height = window.innerHeight - 200,\n        innerWidth = width - margin.left - margin.right,\n        innerHeight = height - margin.top - margin.bottom,\n        svg = d3.select('#line-chart>.viz-svg-wrap').append('svg').attr('width', width).attr('height', height).attr('class', 'viz'),\n        x = d3.scaleTime().domain(d3.extent(data, (d, i) => {\n      return d.date;\n    })).range([0, innerWidth]).nice(),\n        y = d3.scaleLinear().domain(d3.extent(data, (d, i) => {\n      return d.level;\n    })).range([innerHeight, 0]).nice(),\n        totalLength = null; // Grid lines\n\n    svg.append('g').attr('class', 'y grid').attr('transform', 'translate(' + margin.left + ', ' + height + ')').call(d3.axisBottom(x).ticks(5).tickSize(-height).tickFormat(''));\n    d3.selectAll('.y.grid>.tick').each(function (d, i) {\n      d3.select(this).attr(\"stroke-dasharray\", height + \" \" + height).attr(\"stroke-dashoffset\", height).transition().duration(800).ease(d3.easeCubicOut).attr('stroke-dashoffset', function () {\n        if (i % 2 === 0) {\n          return 0;\n        } else {\n          return 2 * height;\n        }\n      });\n    });\n    svg.append('g').attr('class', 'x grid').attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')').call(d3.axisLeft(y).ticks(5).tickSize(-width).tickFormat(''));\n    d3.selectAll('.x.grid>.tick').each(function (d, i) {\n      d3.select(this).attr(\"stroke-dasharray\", width + \" \" + width).attr(\"stroke-dashoffset\", width).transition().duration(800).ease(d3.easeCubicOut).attr('stroke-dashoffset', function () {\n        if (i % 2 === 0) {\n          return 0;\n        } else {\n          return 2 * width;\n        }\n      });\n    }); // Axes\n\n    svg.append('g').attr('class', 'x axis').attr('transform', 'translate(' + margin.left + ', ' + (innerHeight + margin.top) + ')').style(\"opacity\", 0).transition().duration(800).ease(d3.easeQuad).style('opacity', 1).call(d3.axisBottom(x).ticks(5).tickSize(0).tickPadding(24));\n    svg.append('g').attr('class', 'y axis').attr('transform', 'translate(' + (innerWidth + margin.left) + ', ' + margin.top + ')').style(\"opacity\", 0).transition().duration(800).ease(d3.easeQuad).style('opacity', 1).call(d3.axisRight(y).ticks(5).tickSize(0).tickPadding(32));\n    svg.append('line').attr('class', 'bottom-axis').attr(\"x1\", 0).attr(\"y1\", height - margin.bottom).attr(\"x2\", width).attr(\"y2\", height - margin.bottom).style(\"opacity\", 0).transition().duration(800).ease(d3.easeQuadOut).style('opacity', 1);\n    this.setState({\n      updateFunc: (to, from) => {\n        let regLineLength = null,\n            minDate = d3.min(data, function (d) {\n          return d.date;\n        }),\n            xDays = data.map(d => Math.ceil((d.date.getTime() - minDate.getTime()) / (1000 * 60 * 60 * 24))),\n            yReg = null;\n\n        if (!this.state.vizCreated) {\n          this.createViz(this.props.data);\n\n          for (let i = 0; i < to; i++) {\n            this.state.undateFunc(i);\n          }\n        }\n\n        switch (to) {\n          case 0:\n            // Initial\n            // Main data line\n            let dataLine = svg.append('path').datum(data).attr('class', 'data-line').attr('d', d3.line().x(function (d) {\n              return x(d.date) + margin.left;\n            }).y(function (d) {\n              return y(d.level) + margin.top;\n            })); // Animate data line\n\n            totalLength = dataLine.node().getTotalLength();\n            dataLine.attr(\"stroke-dasharray\", totalLength + \" \" + totalLength).attr(\"stroke-dashoffset\", totalLength).transition().duration(800).ease(d3.easeCubicOut).attr('stroke-dashoffset', 0);\n            break;\n\n          case 1:\n            // Linear\n            yReg = xDays.map(d => this.props.content[1].params[0] + this.props.content[1].params[1] * d);\n            let regLine = svg.append('path').datum(data).attr('class', 'reg-line').attr('d', d3.line().x(function (d) {\n              return x(d.date) + margin.left;\n            }).y(function (d, i) {\n              return y(yReg[i]) + margin.top;\n            })),\n                regLineLabel = svg.append('g').attr('class', 'reg-line-label').attr('transform', 'translate(' + (x(data[Math.ceil(data.length * 0.52)]['date']) + margin.left + 60) + ', ' + (y(yReg[Math.ceil(yReg.length * 0.52)]) + margin.top + 20) + ')');\n            regLineLabel.style('opacity', 0).transition().duration(720).ease(d3.easeQuad).style('opacity', 1);\n            regLineLabel.append('rect').attr('class', 'reg-line-label-rect linear').attr('rx', 4).attr('ry', 4);\n            let regLineLabelText = regLineLabel.append('text').attr('class', 'reg-line-label-text');\n            regLineLabelText.append('tspan').attr('class', 'linear span').text('y = αx');\n            regLineLength = regLine.node().getTotalLength();\n            regLine.attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength).attr(\"stroke-dashoffset\", regLineLength).transition().duration(800).ease(d3.easeCubicOut).attr('stroke-dashoffset', 0);\n            d3.select('.data-line').attr('class', 'data-line faded');\n            d3.selectAll('.reg-line-label-text>tspan:not(.linear)').each(function (d) {\n              let currentSpan = d3.select(this);\n\n              if (!currentSpan.node().classList.contains('off')) {\n                currentSpan.node().classList.add('off');\n              }\n            });\n            break;\n\n          case 2:\n            // Quadratic\n            yReg = xDays.map(d => this.props.content[2].params[0] + this.props.content[2].params[1] * d + this.props.content[2].params[2] * d ** 2);\n            d3.select('.reg-line').transition().duration(800).ease(d3.easeCubicOut).attr('d', d3.line().x(function (d) {\n              return x(d.date) + margin.left;\n            }).y(function (d, i) {\n              return y(yReg[i]) + margin.top;\n            }));\n            regLineLength = d3.select('.reg-line').node().getTotalLength();\n            d3.select('.reg-line').attr(\"stroke-dasharray\", 0).attr('stroke-dashoffset', 0);\n            d3.select('.reg-line-label-rect').attr('class', 'reg-line-label-rect quadratic');\n            d3.select('.reg-line-label-text').append('tspan').attr('class', 'quadratic span').text(' + βx\\u00b2').style('opacity', 0).transition().duration(800).ease(d3.easeQuad).style('opacity', 1);\n            d3.selectAll('.reg-line-label-text>tspan:not(.quadratic)').each(function (d) {\n              let currentSpan = d3.select(this);\n\n              if (!currentSpan.node().classList.contains('off')) {\n                currentSpan.node().classList.add('off');\n              }\n            });\n            break;\n\n          case 3:\n            // Cosine\n            yReg = xDays.map(d => this.props.content[3].params[0] + this.props.content[3].params[1] * d + this.props.content[3].params[2] * d ** 2 + this.props.content[3].params[3] * Math.cos(2 * Math.PI * d / 365.25 + this.props.content[3].params[4]));\n            d3.select('.reg-line').attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength).transition().duration(800).ease(d3.easeCubicOut).attr('d', d3.line().x(function (d) {\n              return x(d.date) + margin.left;\n            }).y(function (d, i) {\n              return y(yReg[i]) + margin.top;\n            }));\n            regLineLength = d3.select('.reg-line').node().getTotalLength();\n            d3.select('.reg-line').attr(\"stroke-dasharray\", 0).attr('stroke-dashoffset', 0);\n            d3.select('.reg-line-label-rect').attr('class', 'reg-line-label-rect cosine');\n            d3.select('.reg-line-label-text').append('tspan').attr('class', 'cosine span').text(' + cos(2πt + φ)').style('opacity', 0).transition().duration(800).ease(d3.easeQuad).style('opacity', 1);\n            d3.selectAll('.reg-line-label-text>tspan:not(.cosine)').each(function (d) {\n              let currentSpan = d3.select(this);\n\n              if (!currentSpan.node().classList.contains('off')) {\n                currentSpan.node().classList.add('off');\n              }\n            });\n            break;\n\n          default:\n        }\n      }\n    });\n  }\n\n  componentDidMount() {\n    let vizObserver = new IntersectionObserver((entries, observer) => {\n      console.log(entries[0].isIntersecting);\n\n      if (entries[0].isIntersecting && !this.state.vizCreated) {\n        this.setState({\n          vizCreated: true\n        }, () => {\n          this.createViz(this.props.data);\n        });\n      }\n    }, {\n      rootMargin: '0 0 -70%',\n      threshold: 0\n    });\n    vizObserver.observe(this.vizRef.current);\n    let vizScrollObserver = new IntersectionObserver((entries, observer) => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          let index = entry.target.dataset.index,\n              el = this.vizRef.current.querySelector('.viz-des-text:nth-child(' + (Number(index) + 1) + ')');\n          el.classList.add('on');\n          el.classList.remove('off');\n          this.vizRef.current.querySelectorAll('.viz-des-text:not(:nth-child(' + (Number(index) + 1) + '))').forEach(el => {\n            if (el.classList.contains('on')) {\n              el.classList.add('off');\n              setTimeout(() => {\n                el.classList.remove('on');\n              }, 800);\n            }\n          });\n          this.state.updateFunc(Number(index));\n        }\n      });\n    }, {\n      rootMargin: '0 0 -25%',\n      threshold: 1\n    });\n    document.querySelectorAll('.viz-scroll-anchor').forEach(el => {\n      vizScrollObserver.observe(el);\n    });\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"viz-outer-wrap\",\n      ref: this.vizRef,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 322\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"viz-wrap\",\n      id: \"line-chart\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 323\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"viz-svg-wrap\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"viz-des-wrap\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 325\n      },\n      __self: this\n    }, this.props.content.map((chunk, index) => {\n      return React.createElement(\"p\", {\n        className: \"viz-des-text\",\n        key: index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328\n        },\n        __self: this\n      }, chunk.des);\n    }))), React.createElement(\"div\", {\n      className: \"viz-scroll-box\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 333\n      },\n      __self: this\n    }, this.props.content.map((_, index) => {\n      return React.createElement(\"div\", {\n        className: \"viz-scroll-anchor\",\n        \"data-index\": index,\n        key: index,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 336\n        },\n        __self: this\n      });\n    })));\n  }\n\n}\n\nexport default LineChart;","map":{"version":3,"sources":["/Users/vu/Documents/Work/Repositories/co2/src/components/section/viz/LineChart.js"],"names":["React","Component","d3","LineChart","constructor","props","state","vizCreated","updateFunc","createViz","bind","vizRef","createRef","data","margin","top","right","bottom","left","width","window","innerWidth","height","innerHeight","svg","select","append","attr","x","scaleTime","domain","extent","d","i","date","range","nice","y","scaleLinear","level","totalLength","call","axisBottom","ticks","tickSize","tickFormat","selectAll","each","transition","duration","ease","easeCubicOut","axisLeft","style","easeQuad","tickPadding","axisRight","easeQuadOut","setState","to","from","regLineLength","minDate","min","xDays","map","Math","ceil","getTime","yReg","undateFunc","dataLine","datum","line","node","getTotalLength","content","params","regLine","regLineLabel","length","regLineLabelText","text","currentSpan","classList","contains","add","cos","PI","componentDidMount","vizObserver","IntersectionObserver","entries","observer","console","log","isIntersecting","rootMargin","threshold","observe","current","vizScrollObserver","forEach","entry","index","target","dataset","el","querySelector","Number","remove","querySelectorAll","setTimeout","document","render","chunk","des","_"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './LineChart.css';\nimport * as d3 from 'd3'\n\nclass LineChart extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      vizCreated: false,\n      updateFunc: null\n    }\n    this.createViz = this.createViz.bind(this)\n    this.vizRef = React.createRef()\n  }\n  createViz(data) {\n    let margin = {\n      top: 20,\n      right: 60,\n      bottom: 40,\n      left: 0},\n      width = window.innerWidth - 440,\n      height = window.innerHeight - 200,\n      innerWidth = width - margin.left - margin.right,\n      innerHeight = height - margin.top - margin.bottom,\n      svg = d3.select('#line-chart>.viz-svg-wrap')\n      .append('svg')\n        .attr('width', width)\n        .attr('height', height)\n        .attr('class', 'viz'),\n      x = d3.scaleTime()\n      .domain(d3.extent(data, (d, i) => {return d.date}))\n      .range([0, innerWidth])\n      .nice(),\n      y = d3.scaleLinear()\n      .domain(d3.extent(data, (d, i) => {return d.level}))\n      .range([innerHeight, 0])\n      .nice(),\n      totalLength = null\n\n    // Grid lines\n    svg.append('g')\n      .attr('class', 'y grid')\n      .attr('transform', 'translate(' + margin.left + ', ' + height + ')')\n      .call(d3.axisBottom(x)\n          .ticks(5)\n          .tickSize(-height)\n          .tickFormat('')\n      )\n    d3.selectAll('.y.grid>.tick').each(function(d, i) {\n      d3.select(this).attr(\"stroke-dasharray\", height + \" \" + height)\n        .attr(\"stroke-dashoffset\", height)\n        .transition()\n          .duration(800)\n          .ease(d3.easeCubicOut)\n          .attr('stroke-dashoffset', function() {\n            if (i%2 === 0) {\n              return 0\n            } else {\n              return 2*height\n            }\n          })\n    })\n    svg.append('g')\n      .attr('class', 'x grid')\n      .attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')')\n      .call(d3.axisLeft(y)\n          .ticks(5)\n          .tickSize(-width)\n          .tickFormat('')\n      )\n    d3.selectAll('.x.grid>.tick').each(function(d, i) {\n      d3.select(this).attr(\"stroke-dasharray\", width + \" \" + width)\n        .attr(\"stroke-dashoffset\", width)\n        .transition()\n          .duration(800)\n          .ease(d3.easeCubicOut)\n          .attr('stroke-dashoffset', function() {\n            if (i%2 === 0) {\n              return 0\n            } else {\n              return 2*width\n            }\n          })\n    })\n\n    // Axes\n    svg.append('g')\n      .attr('class', 'x axis')\n      .attr('transform', 'translate(' + margin.left + ', ' + (innerHeight + margin.top) + ')')\n      .style(\"opacity\", 0)\n      .transition()\n        .duration(800)\n        .ease(d3.easeQuad)\n        .style('opacity', 1)\n      .call(d3.axisBottom(x)\n        .ticks(5)\n        .tickSize(0)\n        .tickPadding(24))\n    svg.append('g')\n      .attr('class', 'y axis')\n      .attr('transform', 'translate(' + (innerWidth + margin.left) + ', ' + margin.top + ')')\n      .style(\"opacity\", 0)\n      .transition()\n        .duration(800)\n        .ease(d3.easeQuad)\n        .style('opacity', 1)\n      .call(d3.axisRight(y)\n        .ticks(5)\n        .tickSize(0)\n        .tickPadding(32))\n    svg.append('line')\n      .attr('class', 'bottom-axis')\n      .attr(\"x1\", 0)\n      .attr(\"y1\", height - margin.bottom)\n      .attr(\"x2\", width)\n      .attr(\"y2\", height - margin.bottom)\n      .style(\"opacity\", 0)\n      .transition()\n        .duration(800)\n        .ease(d3.easeQuadOut)\n        .style('opacity', 1)\n\n    this.setState({\n      updateFunc: (to, from) => {\n        let regLineLength = null,\n          minDate = d3.min(data, function(d) {return d.date}),\n          xDays = data.map(d => Math.ceil((d.date.getTime() - minDate.getTime())/(1000*60*60*24))),\n          yReg = null\n        if (!this.state.vizCreated) {\n          this.createViz(this.props.data)\n          for (let i = 0; i < to; i++) {\n            this.state.undateFunc(i)\n          }\n        }\n        switch(to) {\n          case 0: // Initial\n            // Main data line\n            let dataLine = svg.append('path')\n              .datum(data)\n              .attr('class', 'data-line')\n              .attr('d', d3.line()\n                .x(function(d) { return x(d.date) + margin.left })\n                .y(function(d) { return y(d.level) + margin.top })\n              )\n\n            // Animate data line\n            totalLength = dataLine.node().getTotalLength()\n            dataLine.attr(\"stroke-dasharray\", totalLength + \" \" + totalLength)\n              .attr(\"stroke-dashoffset\", totalLength)\n              .transition()\n                .duration(800)\n                .ease(d3.easeCubicOut)\n                .attr('stroke-dashoffset', 0)\n            break\n          case 1: // Linear\n            yReg = xDays.map(d => this.props.content[1].params[0] + this.props.content[1].params[1]*d)\n            let regLine = svg.append('path')\n              .datum(data)\n              .attr('class', 'reg-line')\n              .attr('d', d3.line()\n                .x(function(d) { return x(d.date) + margin.left })\n                .y(function(d, i) {return y(yReg[i]) + margin.top })\n            ),\n            regLineLabel = svg.append('g')\n              .attr('class', 'reg-line-label')\n              .attr('transform',\n                'translate('\n                + (x(data[Math.ceil(data.length*0.52)]['date']) + margin.left + 60)\n                + ', '\n                + (y(yReg[Math.ceil(yReg.length*0.52)]) + margin.top + 20)\n                + ')'\n              )\n            regLineLabel.style('opacity', 0)\n              .transition()\n                .duration(720)\n                .ease(d3.easeQuad)\n                .style('opacity', 1)\n            regLineLabel.append('rect')\n              .attr('class', 'reg-line-label-rect linear')\n              .attr('rx', 4)\n              .attr('ry', 4)\n            let regLineLabelText = regLineLabel.append('text')\n                .attr('class', 'reg-line-label-text')\n            regLineLabelText.append('tspan')\n                .attr('class', 'linear span')\n                .text('y = αx')\n            regLineLength = regLine.node().getTotalLength()\n            regLine.attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength)\n              .attr(\"stroke-dashoffset\", regLineLength)\n              .transition()\n                .duration(800)\n                .ease(d3.easeCubicOut)\n                .attr('stroke-dashoffset', 0)\n            d3.select('.data-line').attr('class', 'data-line faded')\n            d3.selectAll('.reg-line-label-text>tspan:not(.linear)')\n              .each(function(d) {\n                let currentSpan = d3.select(this)\n                if (!currentSpan.node().classList.contains('off')) {\n                  currentSpan.node().classList.add('off')\n                }\n              })\n            break\n          case 2: // Quadratic\n            yReg = xDays.map(d => this.props.content[2].params[0] + this.props.content[2].params[1]*d + this.props.content[2].params[2]*d**2)\n            d3.select('.reg-line').transition()\n              .duration(800)\n              .ease(d3.easeCubicOut)\n              .attr('d', d3.line()\n                .x(function(d) { return x(d.date) + margin.left })\n                .y(function(d, i) {return y(yReg[i]) + margin.top })\n              )\n            regLineLength = d3.select('.reg-line').node().getTotalLength()\n            d3.select('.reg-line').attr(\"stroke-dasharray\", 0)\n              .attr('stroke-dashoffset', 0)\n            d3.select('.reg-line-label-rect')\n              .attr('class', 'reg-line-label-rect quadratic')\n            d3.select('.reg-line-label-text').append('tspan')\n              .attr('class', 'quadratic span')\n              .text(' + βx\\u00b2')\n              .style('opacity', 0)\n                .transition()\n                  .duration(800)\n                  .ease(d3.easeQuad)\n                  .style('opacity', 1)\n            d3.selectAll('.reg-line-label-text>tspan:not(.quadratic)')\n              .each(function(d) {\n                let currentSpan = d3.select(this)\n                if (!currentSpan.node().classList.contains('off')) {\n                  currentSpan.node().classList.add('off')\n                }\n              })\n            break\n          case 3: // Cosine\n            yReg = xDays.map(d => this.props.content[3].params[0]\n              + this.props.content[3].params[1]*d\n              + this.props.content[3].params[2]*d**2\n              + this.props.content[3].params[3]*Math.cos(2*Math.PI*d/365.25 + this.props.content[3].params[4])\n            )\n            d3.select('.reg-line').attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength)\n              .transition()\n                .duration(800)\n                .ease(d3.easeCubicOut)\n                .attr('d', d3.line()\n                  .x(function(d) { return x(d.date) + margin.left })\n                  .y(function(d, i) {return y(yReg[i]) + margin.top })\n              )\n            regLineLength = d3.select('.reg-line').node().getTotalLength()\n            d3.select('.reg-line').attr(\"stroke-dasharray\", 0)\n              .attr('stroke-dashoffset', 0)\n            d3.select('.reg-line-label-rect')\n              .attr('class', 'reg-line-label-rect cosine')\n            d3.select('.reg-line-label-text').append('tspan')\n              .attr('class', 'cosine span')\n              .text(' + cos(2πt + φ)')\n              .style('opacity', 0)\n                .transition()\n                  .duration(800)\n                  .ease(d3.easeQuad)\n                  .style('opacity', 1)\n            d3.selectAll('.reg-line-label-text>tspan:not(.cosine)')\n              .each(function(d) {\n                let currentSpan = d3.select(this)\n                if (!currentSpan.node().classList.contains('off')) {\n                  currentSpan.node().classList.add('off')\n                }\n              })\n            break\n          default:\n        }\n      }\n    })\n  }\n  componentDidMount() {\n    let vizObserver = new IntersectionObserver(\n      (entries, observer) => {\n        console.log(entries[0].isIntersecting)\n        if (entries[0].isIntersecting && !this.state.vizCreated) {\n          this.setState({\n            vizCreated: true\n          }, () => {\n            this.createViz(this.props.data)\n          })\n        }\n      },\n      {\n        rootMargin: '0 0 -70%',\n        threshold: 0\n      })\n    vizObserver.observe(this.vizRef.current)\n\n    let vizScrollObserver = new IntersectionObserver(\n      (entries, observer) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            let index = entry.target.dataset.index,\n              el = this.vizRef.current.querySelector('.viz-des-text:nth-child(' + (Number(index) + 1) + ')')\n            el.classList.add('on')\n            el.classList.remove('off')\n            this.vizRef.current.querySelectorAll('.viz-des-text:not(:nth-child(' + (Number(index) + 1) + '))').forEach(el => {\n              if (el.classList.contains('on')) {\n                el.classList.add('off')\n                setTimeout(() => {\n                  el.classList.remove('on')\n                }, 800)\n              }\n            })\n            this.state.updateFunc(Number(index))\n          }\n        })\n      },\n      {\n        rootMargin: '0 0 -25%',\n        threshold: 1\n      }\n    )\n    document.querySelectorAll('.viz-scroll-anchor').forEach(el => {\n      vizScrollObserver.observe(el)\n    })\n  }\n  render() {\n    return (\n      <div className=\"viz-outer-wrap\" ref={this.vizRef}>\n        <div className=\"viz-wrap\" id=\"line-chart\">\n          <div className=\"viz-svg-wrap\"></div>\n          <div className=\"viz-des-wrap\">\n            {this.props.content.map((chunk, index) => {\n              return (\n                <p className=\"viz-des-text\" key={index}>{chunk.des}</p>\n              )\n            })}\n          </div>\n        </div>\n        <div className=\"viz-scroll-box\">\n          {this.props.content.map((_, index) => {\n            return (\n              <div className=\"viz-scroll-anchor\" data-index={index} key={index}></div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default LineChart;\n"]},"metadata":{},"sourceType":"module"}