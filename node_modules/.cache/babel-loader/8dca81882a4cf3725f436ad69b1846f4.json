{"ast":null,"code":"var _jsxFileName = \"/Users/vu/Documents/Work/Repositories/co2/src/App.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport * as d3 from 'd3';\nconst constants = {\n  linear: [306.06644452, 0.00430901514],\n  quadratic: [314.574751, 0.00210065413, 0.0000000973625567],\n  cosine: [314.569048, 0.00210632696, 0.0000000970576557, 2.86111474, -0.554076698]\n};\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      originalData: [],\n      styles: {\n        dark: '#333344',\n        normal: '#555566',\n        light: '#999999',\n        line: '#EEEEEE',\n        theme: '#4BA824'\n      },\n      chartState: 'initial'\n    };\n  }\n\n  componentDidMount() {\n    let margin = {\n      top: 20,\n      right: 60,\n      bottom: 40,\n      left: 0\n    },\n        width = 800,\n        height = 600,\n        innerWidth = width - margin.left - margin.right,\n        innerHeight = height - margin.top - margin.bottom,\n        svg = d3.select('#App').append('svg').attr('width', width).attr('height', height);\n    d3.csv('data/weekly_in_situ_co2_mlo.csv').then(data => {\n      data.forEach(function (d) {\n        d.date = d3.timeParse('%Y-%m-%d')(d.date);\n        d.level = +d.level;\n      });\n      this.setState({\n        originalData: data\n      }, () => {\n        let x = d3.scaleTime().domain(d3.extent(data, (d, i) => {\n          return d.date;\n        })).range([0, innerWidth]).nice(),\n            y = d3.scaleLinear().domain(d3.extent(data, (d, i) => {\n          return d.level;\n        })).range([innerHeight, 0]).nice(),\n            totalLength = null; // Grid lines\n\n        svg.append('g').attr('class', 'y grid').attr('transform', 'translate(' + margin.left + ', ' + height + ')').call(d3.axisBottom(x).ticks(5).tickSize(-height).tickFormat(''));\n        svg.append('g').attr('class', 'x grid').attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')').call(d3.axisLeft(y).ticks(5).tickSize(-width).tickFormat('')); // Axes\n\n        svg.append('g').attr('class', 'x axis').attr('transform', 'translate(' + margin.left + ', ' + (innerHeight + margin.top) + ')').call(d3.axisBottom(x).ticks(5).tickSize(0).tickPadding(24));\n        svg.append('g').attr('class', 'y axis').attr('transform', 'translate(' + (innerWidth + margin.left) + ', ' + margin.top + ')').call(d3.axisRight(y).ticks(5).tickSize(0).tickPadding(32));\n        svg.append('line').attr('class', 'bottom-axis').attr(\"x1\", 0).attr(\"y1\", height - margin.bottom).attr(\"x2\", width).attr(\"y2\", height - margin.bottom); // Main data line\n\n        let dataLine = svg.append('path').datum(data).attr('class', 'data-line').attr('d', d3.line().x(function (d) {\n          return x(d.date) + margin.left;\n        }).y(function (d) {\n          return y(d.level) + margin.top;\n        })); // Animate data line\n\n        totalLength = dataLine.node().getTotalLength();\n        dataLine.attr(\"stroke-dasharray\", totalLength + \" \" + totalLength).attr(\"stroke-dashoffset\", totalLength).transition().delay(400).duration(600).ease(d3.easeCubicOut).attr('stroke-dashoffset', 0);\n\n        let updateReg = function (newState) {\n          let regLineLength = null,\n              minDate = d3.min(data, function (d) {\n            return d.date;\n          }),\n              xDays = data.map(d => Math.ceil((d.date.getTime() - minDate.getTime()) / (1000 * 60 * 60 * 24))),\n              yReg = null;\n\n          switch (newState) {\n            case 'linear':\n              yReg = xDays.map(d => constants.linear[0] + constants.linear[1] * d);\n              let regLine = svg.append('path').datum(data).attr('class', 'reg-line').attr('d', d3.line().x(function (d) {\n                return x(d.date) + margin.left;\n              }).y(function (d, i) {\n                return y(yReg[i]) + margin.top;\n              })),\n                  regLineLabel = svg.append('g').attr('class', 'reg-line-label').attr('transform', 'translate(' + (x(data[Math.ceil(data.length / 2)]['date']) + margin.left + 20) + ', ' + (y(yReg[Math.ceil(yReg.length / 2)]) + margin.top + 20) + ')');\n              regLineLabel.append('rect').attr('class', 'reg-line-label-rect');\n              regLineLabel.append('path').attr('class', 'reg-line-label-triangle');\n              let regLineLabelText = regLineLabel.append('text').attr('class', 'reg-line-label-text').append('tspan').attr('class', 'linear span').text('y = ax');\n              regLineLength = regLine.node().getTotalLength();\n              regLine.attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength).attr(\"stroke-dashoffset\", regLineLength).transition().duration(600).ease(d3.easeCubicOut).attr('stroke-dashoffset', 0);\n              dataLine.node().style.stroke = 'var(--line)';\n              break;\n\n            case 'quadratic':\n              yReg = xDays.map(d => constants.quadratic[0] + constants.quadratic[1] * d + constants.quadratic[2] * d ** 2);\n              d3.select('.reg-line').transition().duration(600).ease(d3.easeQuad).attr('d', d3.line().x(function (d) {\n                return x(d.date) + margin.left;\n              }).y(function (d, i) {\n                return y(yReg[i]) + margin.top;\n              }));\n              regLineLength = d3.select('.reg-line').node().getTotalLength();\n              d3.select('.reg-line').attr(\"stroke-dasharray\", 0).attr('stroke-dashoffset', 0);\n              break;\n\n            case 'cosine':\n              yReg = xDays.map(d => constants.cosine[0] + constants.cosine[1] * d + constants.cosine[2] * d ** 2 + constants.cosine[3] * Math.cos(2 * Math.PI * d / 365.25 + constants.cosine[4]));\n              d3.select('.reg-line').attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength).transition().duration(600).ease(d3.easeQuad).attr('d', d3.line().x(function (d) {\n                return x(d.date) + margin.left;\n              }).y(function (d, i) {\n                return y(yReg[i]) + margin.top;\n              }));\n              regLineLength = d3.select('.reg-line').node().getTotalLength();\n              d3.select('.reg-line').attr(\"stroke-dasharray\", 0).attr('stroke-dashoffset', 0);\n              break;\n\n            default:\n          }\n        };\n\n        this.setState({\n          updateReg: updateReg\n        });\n      });\n    });\n    window.addEventListener('click', () => {\n      if (this.state.chartState === 'initial') {\n        this.setState({\n          chartState: 'linear'\n        }, () => this.state.updateReg('linear'));\n      } else if (this.state.chartState === 'linear') {\n        this.setState({\n          chartState: 'quadratic'\n        }, () => this.state.updateReg('quadratic'));\n      } else if (this.state.chartState === 'quadratic') {\n        this.setState({\n          chartState: 'cosine'\n        }, () => this.state.updateReg('cosine'));\n      }\n    });\n  }\n\n  render() {\n    let styles = this.state.styles;\n    return React.createElement(\"div\", {\n      id: \"App\",\n      style: {\n        '--dark': styles.dark,\n        '--normal': styles.normal,\n        '--light': styles.light,\n        '--line': styles.line,\n        '--theme': styles.theme,\n        '--theme-readable': styles.themeReadable\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227\n      },\n      __self: this\n    });\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/vu/Documents/Work/Repositories/co2/src/App.js"],"names":["React","Component","d3","constants","linear","quadratic","cosine","App","constructor","props","state","originalData","styles","dark","normal","light","line","theme","chartState","componentDidMount","margin","top","right","bottom","left","width","height","innerWidth","innerHeight","svg","select","append","attr","csv","then","data","forEach","d","date","timeParse","level","setState","x","scaleTime","domain","extent","i","range","nice","y","scaleLinear","totalLength","call","axisBottom","ticks","tickSize","tickFormat","axisLeft","tickPadding","axisRight","dataLine","datum","node","getTotalLength","transition","delay","duration","ease","easeCubicOut","updateReg","newState","regLineLength","minDate","min","xDays","map","Math","ceil","getTime","yReg","regLine","regLineLabel","length","regLineLabelText","text","style","stroke","easeQuad","cos","PI","window","addEventListener","render","themeReadable"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport * as d3 from 'd3'\n\nconst constants = {\n  linear: [\n    306.06644452,\n    0.00430901514\n  ],\n  quadratic: [\n    314.574751,\n    0.00210065413,\n    0.0000000973625567\n  ],\n  cosine: [\n    314.569048,\n    0.00210632696,\n    0.0000000970576557,\n    2.86111474,\n    -0.554076698]\n}\n\nclass App extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      originalData: [],\n      styles: {\n        dark: '#333344',\n        normal: '#555566',\n        light: '#999999',\n        line: '#EEEEEE',\n        theme: '#4BA824'\n      },\n      chartState: 'initial'\n    }\n  }\n  componentDidMount() {\n    let margin = {top: 20, right: 60, bottom: 40, left: 0},\n      width = 800,\n      height = 600,\n      innerWidth = width - margin.left - margin.right,\n      innerHeight = height - margin.top - margin.bottom,\n      svg = d3.select('#App')\n      .append('svg')\n        .attr('width', width)\n        .attr('height', height)\n\n    d3.csv('data/weekly_in_situ_co2_mlo.csv').then(data => {\n      data.forEach(function(d) {\n        d.date = d3.timeParse('%Y-%m-%d')(d.date)\n        d.level = +d.level\n      })\n      this.setState({\n        originalData: data\n      }, () => {\n        let x = d3.scaleTime()\n          .domain(d3.extent(data, (d, i) => {return d.date}))\n          .range([0, innerWidth])\n          .nice(),\n          y = d3.scaleLinear()\n          .domain(d3.extent(data, (d, i) => {return d.level}))\n          .range([innerHeight, 0])\n          .nice(),\n          totalLength = null\n\n        // Grid lines\n        svg.append('g')\n          .attr('class', 'y grid')\n          .attr('transform', 'translate(' + margin.left + ', ' + height + ')')\n          .call(d3.axisBottom(x)\n              .ticks(5)\n              .tickSize(-height)\n              .tickFormat('')\n          )\n        svg.append('g')\n          .attr('class', 'x grid')\n          .attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')')\n          .call(d3.axisLeft(y)\n              .ticks(5)\n              .tickSize(-width)\n              .tickFormat('')\n          )\n\n        // Axes\n        svg.append('g')\n          .attr('class', 'x axis')\n          .attr('transform', 'translate(' + margin.left + ', ' + (innerHeight + margin.top) + ')')\n          .call(d3.axisBottom(x)\n            .ticks(5)\n            .tickSize(0)\n            .tickPadding(24))\n        svg.append('g')\n          .attr('class', 'y axis')\n          .attr('transform', 'translate(' + (innerWidth + margin.left) + ', ' + margin.top + ')')\n          .call(d3.axisRight(y)\n            .ticks(5)\n            .tickSize(0)\n            .tickPadding(32))\n        svg.append('line')\n          .attr('class', 'bottom-axis')\n          .attr(\"x1\", 0)\n          .attr(\"y1\", height - margin.bottom)\n          .attr(\"x2\", width)\n          .attr(\"y2\", height - margin.bottom)\n\n        // Main data line\n        let dataLine = svg.append('path')\n          .datum(data)\n          .attr('class', 'data-line')\n          .attr('d', d3.line()\n            .x(function(d) { return x(d.date) + margin.left })\n            .y(function(d) { return y(d.level) + margin.top })\n          )\n\n        // Animate data line\n        totalLength = dataLine.node().getTotalLength()\n        dataLine.attr(\"stroke-dasharray\", totalLength + \" \" + totalLength)\n          .attr(\"stroke-dashoffset\", totalLength)\n          .transition()\n            .delay(400)\n            .duration(600)\n            .ease(d3.easeCubicOut)\n            .attr('stroke-dashoffset', 0)\n\n        let updateReg = function(newState) {\n          let regLineLength = null,\n            minDate = d3.min(data, function(d) {return d.date}),\n            xDays = data.map(d => Math.ceil((d.date.getTime() - minDate.getTime())/(1000*60*60*24))),\n            yReg = null\n          switch(newState) {\n            case 'linear':\n              yReg = xDays.map(d => constants.linear[0] + constants.linear[1]*d)\n              let regLine = svg.append('path')\n                .datum(data)\n                .attr('class', 'reg-line')\n                .attr('d', d3.line()\n                  .x(function(d) { return x(d.date) + margin.left })\n                  .y(function(d, i) {return y(yReg[i]) + margin.top })\n              ),\n              regLineLabel = svg.append('g')\n                .attr('class', 'reg-line-label')\n                .attr('transform',\n                  'translate('\n                  + (x(data[Math.ceil(data.length/2)]['date']) + margin.left + 20)\n                  + ', '\n                  + (y(yReg[Math.ceil(yReg.length/2)]) + margin.top + 20)\n                  + ')'\n                )\n              regLineLabel.append('rect')\n                .attr('class', 'reg-line-label-rect')\n              regLineLabel.append('path')\n                .attr('class', 'reg-line-label-triangle')\n              let regLineLabelText = regLineLabel.append('text')\n                  .attr('class', 'reg-line-label-text')\n                  .append('tspan')\n                    .attr('class', 'linear span')\n                    .text('y = ax')\n              regLineLength = regLine.node().getTotalLength()\n              regLine.attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength)\n                .attr(\"stroke-dashoffset\", regLineLength)\n                .transition()\n                  .duration(600)\n                  .ease(d3.easeCubicOut)\n                  .attr('stroke-dashoffset', 0)\n              dataLine.node().style.stroke = 'var(--line)'\n              break\n            case 'quadratic':\n              yReg = xDays.map(d => constants.quadratic[0] + constants.quadratic[1]*d + constants.quadratic[2]*d**2)\n              d3.select('.reg-line').transition()\n                .duration(600)\n                .ease(d3.easeQuad)\n                .attr('d', d3.line()\n                  .x(function(d) { return x(d.date) + margin.left })\n                  .y(function(d, i) {return y(yReg[i]) + margin.top })\n                )\n              regLineLength = d3.select('.reg-line').node().getTotalLength()\n              d3.select('.reg-line').attr(\"stroke-dasharray\", 0)\n                .attr('stroke-dashoffset', 0)\n              break\n            case 'cosine':\n              yReg = xDays.map(d => constants.cosine[0]\n                + constants.cosine[1]*d\n                + constants.cosine[2]*d**2\n                + constants.cosine[3]*Math.cos(2*Math.PI*d/365.25 + constants.cosine[4])\n              )\n              d3.select('.reg-line').attr(\"stroke-dasharray\", regLineLength + \" \" + regLineLength)\n                .transition()\n                .duration(600)\n                .ease(d3.easeQuad)\n                .attr('d', d3.line()\n                  .x(function(d) { return x(d.date) + margin.left })\n                  .y(function(d, i) {return y(yReg[i]) + margin.top })\n              )\n              regLineLength = d3.select('.reg-line').node().getTotalLength()\n              d3.select('.reg-line').attr(\"stroke-dasharray\", 0)\n                .attr('stroke-dashoffset', 0)\n              break\n            default:\n          }\n        }\n        this.setState({\n          updateReg: updateReg\n        })\n      })\n    })\n\n    window.addEventListener('click', () => {\n      if (this.state.chartState === 'initial') {\n        this.setState({\n          chartState: 'linear'\n        }, () => this.state.updateReg('linear'))\n      } else if (this.state.chartState === 'linear') {\n        this.setState({\n          chartState: 'quadratic'\n        }, () => this.state.updateReg('quadratic'))\n      } else if (this.state.chartState === 'quadratic') {\n        this.setState({\n          chartState: 'cosine'\n        }, () => this.state.updateReg('cosine'))\n      }\n    })\n  }\n  render() {\n    let styles = this.state.styles\n    return (\n      <div\n        id=\"App\"\n        style={{\n            '--dark': styles.dark,\n            '--normal': styles.normal,\n            '--light': styles.light,\n            '--line': styles.line,\n            '--theme': styles.theme,\n            '--theme-readable': styles.themeReadable\n          }}>\n      </div>\n    )\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}